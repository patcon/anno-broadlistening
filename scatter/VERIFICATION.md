# 動作確認手順書

本ドキュメントは、anno-broadlisteningの開発における動作確認手順をまとめたものです。

## 1. Next.jsフロントエンドの動作確認

### 1.1 環境準備
```bash
cd scatter/next-app
npm ci  # 依存パッケージのインストール
```

### 1.2 基本的な動作確認
1. 開発用ビルドの確認
```bash
npm run build
```
- エラーなくビルドが完了することを確認
- `next-app/.next`ディレクトリが生成されることを確認

2. 静的HTMLのビルド
```bash
REPORT=<name> npm run build
```
- `<name>`には対象のレポート名（例：example-polis）を指定
- `out`ディレクトリに静的HTMLファイルが生成されることを確認
- 以下のファイルが正しく生成されることを確認：
  - トップページ（index.html）
  - レポートページ（report/[name]/index.html）
  - 404ページ（404.html）
- 注意：トップページのデータサイズが大きい（約150kB）のは、分析結果データを静的に埋め込んでいるため

3. 開発サーバーの起動
```bash
npm run dev
```
- http://localhost:3000 でアプリケーションにアクセス可能なことを確認

3. ブラウザでの表示確認（重要）
- トップページ（http://localhost:3000）
  - 利用可能なレポート一覧が表示されることを確認
  - レポートへのリンクが機能することを確認

- レポートページ（例：http://localhost:3000/report/example-polis）
  - タイトルと概要が正しく表示されることを確認
  - 散布図（インタラクティブマップ）が表示されることを確認
  - クラスター分析結果が表示されることを確認
  - 付録セクションが表示されることを確認

4. インタラクティブ機能の確認
- 全画面地図表示
  - 「全画面地図を開く」ボタンが機能することを確認
  - ラベル表示/非表示の切り替えが機能することを確認
  - タイトル表示/非表示の切り替えが機能することを確認
  - 割合表示の切り替えが機能することを確認
  - 初期位置に戻す機能が動作することを確認
  - お気に入り一覧機能が動作することを確認
  - 全画面終了が正常に機能することを確認

注意: npm testによるテストは限定的なため、必ずブラウザでの動作確認を実施してください。

### 1.3 変更時の確認ポイント
1. コンポーネントの変更時
- `components/`ディレクトリ内のファイル変更時は、該当コンポーネントの表示確認
- レイアウトやスタイルの変更は、複数の画面サイズでの表示確認

2. ページの変更時
- `pages/`ディレクトリ内のファイル変更時は、該当ページの表示確認
- ルーティングが正しく機能することを確認

## 2. Python分析パイプラインの動作確認

### 2.1 環境準備
```bash
# Python 3.10の準備（pyenvを使用）
pyenv install 3.10
pyenv local 3.10

# 依存パッケージのインストール
pip install -r requirements.txt
```

### 2.2 基本的な動作確認
1. パイプラインの実行
```bash
cd scatter/pipeline
python main.py --config configs/dummy-comments-japan.json
```

2. 出力の確認
- `outputs/`ディレクトリに以下のファイルが生成されることを確認：
  - embeddings.pkl
  - clusters.csv
  - labels.csv
  - result.json
  - translations.json
  - その他設定したアウトプット

### 2.3 変更時の確認ポイント
1. パイプラインステップの変更時
- 変更したステップの出力ファイルが正しく生成されることを確認
- 後続のステップが正常に実行されることを確認
- `python main.py --config configs/dummy-comments-japan.json -o <step-name>`で特定のステップだけ実行可能

2. 設定変更時
- `specs.json`の変更時は、関連するステップの出力を確認
- 新しいパラメータを追加した場合は、デフォルト値での動作を確認

3. プロンプトの変更時
- `prompts/`ディレクトリ内のファイル変更時は、関連するLLMの出力を確認
- 出力フォーマットが期待通りであることを確認

## 3. 統合確認
1. パイプライン出力の表示確認
- パイプラインで生成したレポートがNext.jsフロントエンドで正しく表示されることを確認
- 散布図、クラスター、ラベルなどの表示を確認

2. インタラクティブ機能の確認
- クラスターの選択
- ズーム機能
- フィルター機能
- その他のインタラクティブ要素

## 注意事項
- 本番データでのテストは必要に応じて別途実施
- OpenAI APIキーが必要な場合は、環境変数として設定
- 大規模なデータセットでのテストは、必要に応じて実施者と相談
